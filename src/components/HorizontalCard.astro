---
const {
  title,
  img,
  desc,
  url,
  badge,
  tags,
  target = "_blank",
  authors = [],
  publicationInfo,
  // We no longer auto-link "BIB" to an external file
  // Instead, "BIB" triggers a modal with bibCitation text:
  bibCitation,
  // Optional links if you still want them:
  bibUrl,
  arxivUrl,
  projectUrl
} = Astro.props;

import { Image } from "astro:assets";
const tag_url = url.split("/").slice(0, -1).join("/") + "/tag";
---

<div class="rounded-lg bg-base-100 hover:shadow-xl transition ease-in-out hover:scale-[102%]">
  {/* We do NOT wrap the entire card in an anchor.
      Instead, only the image or the title is clickable to the external link. */}
  <div class="hero-content flex-col md:flex-row">
    {img && (
      <a href={url} target={target} class="block">
        <Image
          src={img}
          width={750}
          height={422}
          format="webp"
          alt={title}
          class="max-w-full md:max-w-[13rem] rounded-lg"
        />
      </a>
    )}

    <div class="grow w-full">
      {/* Title (clickable to URL) */}
      <h1 class="text-xl font-bold">
        <a href={url} target={target} class="hover:underline">
          {title}
        </a>
        {badge && <div class="badge badge-secondary mx-2">{badge}</div>}
      </h1>

      {/* Authors */}
      {authors && authors.length > 0 && (
        <p class="text-sm italic text-gray-500">
          {authors.join(', ')}
        </p>
      )}

      {/* Publication Info */}
      {publicationInfo && (
        <p class="text-sm text-gray-600">
          {publicationInfo}
        </p>
      )}

      {/* Description */}
      {desc && <p class="py-1 text-1xl">{desc}</p>}

      <div class="card-actions justify-end">
        {/* Tags */}
        {tags && tags.map((tag) => (
          <a
            href={`${tag_url}/${tag}`}
            class="badge badge-outline"
            key={tag}
          >
            {tag}
          </a>
        ))}

        {/* If you still want a direct .bib file link, show it if no modal text */}
        {bibUrl && !bibCitation && (
          <a href={bibUrl} target="_blank" class="badge badge-info">
            BIB
          </a>
        )}

        {/* If we have bibCitation, "BIB" opens the modal */}
        {bibCitation && (
          <>
            <label
              for={`${title}-bib-modal`}
              class="badge badge-info cursor-pointer"
            >
              BIB
            </label>
            <input
              type="checkbox"
              id={`${title}-bib-modal`}
              class="modal-toggle"
            />
            {/* The modal: does NOT close on outside click */}
            <div class="modal">
              <div class="modal-box bg-base-100">
                <h3 class="font-bold text-lg">BibTeX</h3>
                <pre class="bg-base-200 p-2 rounded text-sm whitespace-pre-wrap">
{bibCitation}
                </pre>
                <div class="modal-action">
                  <label for={`${title}-bib-modal`} class="btn">
                    Close
                  </label>
                </div>
              </div>
            </div>
          </>
        )}

        {/* Other links if you want them */}
        {arxivUrl && (
          <a
            href={arxivUrl}
            target="_blank"
            class="badge badge-accent"
          >
            ArXiv
          </a>
        )}
        {projectUrl && (
          <a
            href={projectUrl}
            target="_blank"
            class="badge badge-success"
          >
            Project
          </a>
        )}
      </div>
    </div>
  </div>
</div>
