---
const {
  title,
  img,
  desc,
  url,
  badge,
  tags,
  target = "_blank",
  authors = [],
  publicationInfo,
  bibCitation, // The BibTeX text we show in the modal
  bibUrl,      // If you still want a direct link fallback
  arxivUrl,
  projectUrl
} = Astro.props;

import { Image } from "astro:assets";

const tag_url = url.split("/").slice(0, -1).join("/") + "/tag";
---

<div class="rounded-lg bg-base-100 shadow-xl p-4">
  <div class="flex flex-col md:flex-row items-start gap-4">
    {/* Make the image itself clickable (not the entire card) */}
    {img && (
      <a href={url} target={target} class="block">
        <Image
          src={img}
          width={750}
          height={422}
          format="webp"
          alt={title}
          class="rounded-lg max-w-full md:max-w-[13rem]"
        />
      </a>
    )}

    {/* Right side */}
    <div class="grow">
      {/* Title, also clickable */}
      <h1 class="text-xl font-bold">
        <a href={url} target={target} class="hover:underline">
          {title}
        </a>
        {badge && (
          <span class="badge badge-secondary ml-2">{badge}</span>
        )}
      </h1>

      {/* Authors */}
      {authors && authors.length > 0 && (
        <p class="text-sm italic text-gray-500">
          {authors.join(', ')}
        </p>
      )}

      {/* Publication Info */}
      {publicationInfo && (
        <p class="text-sm text-gray-600">{publicationInfo}</p>
      )}

      {/* Description */}
      {desc && (
        <p class="mt-2 text-base">{desc}</p>
      )}

      {/* Tags & Buttons */}
      <div class="flex flex-wrap items-center gap-2 mt-2">
        {/* Tags */}
        {tags && tags.map((tag) => (
          <a
            href={`${tag_url}/${tag}`}
            class="badge badge-outline"
            key={tag}
          >
            {tag}
          </a>
        ))}

        {/* If we have bibCitation, clicking BIB shows a modal */}
        {bibCitation && (
          <>
            <label
              for={`${title}-bib-modal`}
              class="badge badge-info cursor-pointer"
            >
              BIB
            </label>
            <input
              type="checkbox"
              id={`${title}-bib-modal`}
              class="modal-toggle"
            />
            <div class="modal pointer-events-none">
              <div class="modal-box pointer-events-auto bg-base-100">
                <h3 class="font-bold text-lg">BibTeX</h3>
                <pre class="bg-base-200 p-2 rounded text-sm whitespace-pre-wrap">
{bibCitation}
                </pre>
                <div class="modal-action">
                  <label for={`${title}-bib-modal`} class="btn">
                    Close
                  </label>
                </div>
              </div>
            </div>
          </>
        )}

        {/* If no bibCitation but you still want a direct link */}
        {(!bibCitation && bibUrl) && (
          <a
            href={bibUrl}
            target="_blank"
            class="badge badge-info"
          >
            BIB
          </a>
        )}

        {/* ArXiv / Project */}
        {arxivUrl && (
          <a
            href={arxivUrl}
            target="_blank"
            class="badge badge-accent"
          >
            ArXiv
          </a>
        )}
        {projectUrl && (
          <a
            href={projectUrl}
            target="_blank"
            class="badge badge-success"
          >
            Project
          </a>
        )}
      </div>
    </div>
  </div>
</div>
